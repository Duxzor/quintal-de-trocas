

<div class="row">
  <div class="col-sm-3">
    <%= render '/layouts/nav_dashboard' %>
  </div>
  <div class="col-sm-9">

    <br>

    <ul class="progress-indicator">
      <li class="completed">
          <span class="bubble"></span>
          1. Enviar solicitação de troca
      </li>
      <li class="<%= 'completed' if !@exchange.status.blank? %>">
          <span class="bubble"></span>
          2. Resposta de <%= @exchange.toy.user.first_name %> se aceita ou não a troca
      </li>
      <li>
          <span class="bubble"></span>
          3. Combinar local e forma de entrega/troca
      </li>
      <li>
          <span class="bubble"></span>
          4. Confirmar se troca foi efetuada
      </li>
    </ul>

    <h2>
      <% if @exchange.user == current_user %>
        Solicitação de troca com <%= @exchange.toy.user.name %>
      <% else %>
        <%= @exchange.user.name %> quer trocar com você
      <% end %>
    </h2>

    <div class="row exchange-header">
      <div class="col-sm-6">
        <div class="well well-sm">
          <div class="text-muted">Status:</div>

          <% if @exchange.status.blank? %>
            <% if @exchange.user == current_user %>
              <strong class="lead text-danger">
                Aguardando resposta de <%= @exchange.toy.user.first_name %>
              </strong>
            <% else %>
              <strong class="lead text-danger">
                <span class="glyphicon glyphicon-warning-sign"></span> 
                <%= @exchange.user.first_name %> está aguardando sua resposta
              </strong>

              <br>

              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%= link_to 'Responder', exchange_reply_path(@exchange), {:remote => true, 'data-toggle' =>  "modal", 'data-target' => '#reply', class: "btn btn-default"} %>
            <% end %>
          <% else %>
            <strong class="lead text-<%= @exchange.status == 'canceled' ? 'danger' : 'success' %>">
              <span class="glyphicon glyphicon-ok"></span> <%= @exchange.to_user == current_user ? "Você" : @exchange.to_user.first_name %> <%= @exchange.status == "canceled" ? "recusou" : "aceitou" %> essa troca
            </strong>

            <% if @exchange.status != "canceled" %><br>
              Tipo de troca: <%= @exchange.toy_from ? 'por outro brinquedo' : 'por crédito' %>
            <% end %>
          <% end %>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="well well-sm">
          <div class="text-muted"">Troca:</div>

          <div class="row">
            <div class="col-sm-6 exchange-profile">
              <div class="profile-mini" style="background-image:url('<%= default_img(@exchange.user) %>');float: left;margin-right:10px;"></div> <%= @exchange.from_user == current_user ? "Você" : @exchange.from_user.first_name %> <small>solicitou:</small>
              <%= link_to @exchange.to_toy.title, toy_path(@exchange.to_toy) if @exchange.toy %>
            </div>
            <div class="col-sm-6 exchange-profile" style="<%= 'opacity: 0.4' if @exchange.status.blank? %>">
              <div class="profile-mini" style="background-image:url('<%= default_img(@exchange.toy.user) %>');float: left;margin-right:10px;"></div> <%= @exchange.to_user == current_user ? "Você" : @exchange.to_user.first_name %> <small>respondeu:</small>

              <% if @exchange.status.blank? %>
                <div class="text-muted">---</div>
              <% elsif @exchange.from_toy %>
                <%= link_to @exchange.from_toy.title, toy_path(@exchange.from_toy) if @exchange.toy %>
              <% elsif @exchange.status == "credit" %>
                Troca por crédito
              <% else %>
                Recusou a troca
              <% end %>
            </div>
          </div>

        </div>
      </div>
    </div>

    <p class="lead">Mensagens (<%= @messages.count %>)</p>

    <% @messages.each do |msg| %>
    <div class="message">
      <div class="row">
        <div class="col-sm-1">
          <div class="profile-thumb" style="background-image:url('<%= default_img(msg.user) %>');float: left;margin-right:15px;width: 40px;height: 40px;"></div>
        </div>
        <div class="col-sm-11">
          <small class="text-muted"><%= msg.created_at.strftime("%d/%m/%Y - %H:%M") if msg.created_at %></small><br>
          <%= simple_format msg.message %>
        </div>
      </div>
    </div>
    <hr>
    <% end %>

    <div class="row">
      <div class="col-sm-1">
        <div class="profile-thumb" style="background-image:url('<%= default_img(current_user) %>');width: 40px;height: 40px;"></div>
      </div>
      <div class="col-sm-11">
        <%= render 'form_reply' %>
      </div>
    </div>
    
  </div>
</div>

<!-- Reply modal -->
<div class="modal fade" id="reply" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
</div>